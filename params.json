{"name":"Raspberry-pi-web-server","tagline":"How I built a home web server with a Raspberry Pi","body":"# Raspberry Pi Express Web Server\r\nThis is how I built a home web server with a Raspberry Pi, Node JS, and an Express Server.\r\n\r\n## Purchases\r\n\r\n1. [Raspberry Pi B+](http://amzn.com/B00LPESRUK)\r\n2. [Power Supply](http://amzn.com/B00GWDLJGS)\r\n3. [Micro SD Card](http://amzn.com/B00DYQYLQQ) (At least 8 GB)\r\n4. [Case](http://amzn.com/B00MQLB1N6) (Optional)\r\n\r\n![Rasberry Pi](https://www.dropbox.com/s/euujwu3nowunjtk/raspberry-pi.jpg?dl=1)\r\n\r\n## Hardware\r\n\r\n1. Raspberry Pi B+\r\n2. Power Supply for Raspberry Pi\r\n3. Modem and Router\r\n4. Ethernet Cord\r\n\r\n## Setup\r\n\r\n1. Install the operating system by following [these steps](https://www.raspberrypi.org/help/noobs-setup/)\r\n2. Once the operating system is installed, from the command line update the software to the latest.\r\n\r\n\t\t$ sudo apt-get update; sudo apt-get upgrade\r\n4. If wanted, change the default `pi` user password to something more secure.\r\n\r\n\t\t$ sudo raspi-config\r\n6. Navigate to `2 Change User Password` and follow the steps.\r\n\r\n## Install latest NodeJS\r\n\r\n\t$ wget http://node-arm.herokuapp.com/node_latest_armhf.deb\r\n\t$ sudo dpkg -i node_latest_armhf.deb\r\n\t$ node -v\r\n\r\n## Install Git and fork this repo\r\n\r\n\t$ sudo apt-get install git\r\n\t\r\nFork [this](https://github.com/sean-hill/raspberry-pi-web-server.git) repo so that you can commit your own updates later on, then clone your repo to your Pi.\r\n\r\n\t$ cd ~/\r\n\t$ git clone <your-forked-url>\r\n\t\r\n## Run the Webserver\r\n\t$ cd ~/raspberry-pi-web-server\r\n\t$ npm install\r\n\t$ node server.js\r\n\t\r\nOpen a browser and go to `<your-pi's-IP>:5000`\r\n\r\nYou did it! You successfully ran a webserver on your Raspberry Pi. Now what? How about we open up your router to the outside world and setup a deployment method.\r\n\r\n## Dynamic DNS\r\n\r\nIn order for your buddies to access your home web server, you'll need your own domain name that points to your router's dynamic IP provided by your local ISP. I went with the free version of [noip.com](http://www.noip.com/). After creating an account with noip, follow these steps.\r\n\r\n\t$ cd ~/\r\n\t$ wget http://www.no-ip.com/client/linux/noip-duc-linux.tar.gz\r\n\t$ tar vzxf noip-duc-linux.tar.gz\r\n\t$ cd noip-2.1.9-1\r\n\t$ sudo make\r\n\t$ sudo make install\r\n\r\nFollow the commands (entering in your username and password from noip) and then start the process.\r\n\r\n\t$ sudo /usr/local/bin/noip2\r\n\r\nNow we want this to start whenever your raspberry pi boots, so follow [this](http://www.stuffaboutcode.com/2012/06/raspberry-pi-run-program-at-start-up.html) tutorial to create a startup script if you want it.\r\n\r\n## Static Raspberry Pi IP Address\r\n\r\nWhenever your Raspberry Pi reboots, it'll get a new dynamic IP from your router. We'd rather not have this happen, so let's make it a static IP instead. I followed [this](http://www.modmypi.com/blog/tutorial-how-to-give-your-raspberry-pi-a-static-ip-address) tutorial to accomplish this.\r\n\r\n## Open your router to the world\r\n\r\nYou need to enable single port forwarding on your local router. Our webserver is running on port 5000, so I followed [this](http://www.noip.com/support/knowledgebase/port-forwarding-on-a-linksys-wrt610n-router/) tutorial to open up that port on my router. It may be different for each router.\r\n\r\n![Single Port Forwarding](https://www.dropbox.com/s/w98zjpjvm5atnu7/single-port-forwarding.png?dl=1)\r\n\r\nAfter saving these port forwarding settings, start up your server with `node server.js`, and you should be able to navigate to `http://<your-domain>.ddns.net:5000` and see our Raspian homepage!\r\n\r\nI'd love to get rid of the `:5000` at the end of our url, but unfortunately my ISP restricts access to port `80`, so I can't use a proxy service such as `nginx` at this time to proxy pass through all the requests at port `80` to port `5000`.\r\n\r\n## Automated Deployment\r\n\r\nWell, you've done it, you can successfully view a webpage hosted on your raspberry pi from the outside world. For me, that's just the first step. I want to be able to development on my local computer, and push them changes to my pi simply!\r\n\r\n### PM2\r\n\r\nI ❤️ [pm2](https://github.com/Unitech/pm2). It's a great module to deploy your nodejs applications. First let's install it on both your computer and your raspberry pi.\r\n\r\n\t$ sudo npm install -g pm2\r\n\t\r\nI like to store my web server in the `/var/www`. So let's first create that directory and then make the `pi` user the owner.\r\n\r\n\t$ sudo mkdir /var/www\r\n\t$ sudo chown pi /var/www\r\n\t$ sudo chgrp pi /var/www\r\n\t\r\nNow we'll use pm2 to deploy straight from our local machine to our raspberry pi, but first we need to be able to ssh into our raspberry pi. \r\n\r\n\t$ sudo raspi-config\r\n\t$ 8 Advanced Options\r\n\t$ A4 SSH\r\n\t$ Enable\r\n\t\r\nThen you'll need to setup another single port forwarding on your router to allow SSH into your home. For my linksys router I had to find out what port allowed remote access on my router by going to `Administration` and seeing the port under `Remote Management Port`. It was `8080` for me. Then I setup the following single port forwarding.\r\n\r\n![SSH port forwarding](https://www.dropbox.com/s/5yjmevrbm8glzq8/ssh-port-forwarding.png?dl=1)\r\n\r\n\tExternal Port: 8080\r\n\tInternal Port: 22\r\n\tProtocol: Both\r\n\tTo IP Address: <your pi IP>\r\n\tEnabled: Checked\r\n\t\r\nTest that your SSH works by executing this command.\r\n\r\n\t$ ssh -p 8080 pi@<your domain>.ddns.net\r\n\t\r\nNow on your local computer clone this repo.\r\n\r\n\t$ git clone https://github.com/sean-hill/raspberry-pi-web-server.git\r\n\t\r\nThen edit the `ecosystem.json` file and replace the variables between `< >` with your appropriate fields. Once you've done that, execute the following commands on your computer to setup your project on your raspberry pi.\r\n\r\n\t$ pm2 deploy ecosystem.json production setup\r\n\t$ pm2 deploy ecosystem.json production\r\n\t\r\nYou'll be prompted to enter your `pi` password multiple times. If this bothers you, I recommend creating public/private ssh keys on your computer and to copy your public key to your raspberry pi as described [here](https://www.raspberrypi.org/documentation/remote-access/ssh/passwordless.md).\r\n\r\nNow head back over to your raspberry pi, and exectute these commands.\r\n\r\n\t$ cd /var/www\r\n\t$ pm2 list\r\n\t\r\nYou should see your app running and be able to access your server from your browser at `<your-domain>.ddns.net:5000`!\r\n\r\n\t│ Web Server │ 0 │ fork │ 10488 │ online │ 7 │ 6m │ 22.156 MB │ disabled │\r\n\t\r\nNow every time you make changes to your server, commit the changes, push them up, and then deploy your app using pm2. You never have to SSH into your Raspberry Pi.\r\n\r\n## Conclusion\r\n\r\nThis is a bit of tedious process, but you just set up your own personal web server for less then 50 bucks. Pretty sweet! Good luck and let me know if this process could be improved!\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}